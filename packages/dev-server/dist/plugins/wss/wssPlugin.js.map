{"version":3,"file":"wssPlugin.js","names":["fastifyPlugin","WebSocketDebuggerServer","WebSocketDevClientServer","WebSocketMessageServer","WebSocketEventsServer","WebSocketApiServer","WebSocketHMRServer","WebSocketRouter","WebSocketServerAdapter","WS_DEVICE_URL","WS_DEBUGGER_URL","wssPlugin","instance","options","delegate","router","debuggerServer","devClientServer","messageServer","eventsServer","webSocketMessageServer","apiServer","hmrServer","hmr","deviceConnectionServer","endpoints","debuggerConnectionServer","registerServer","decorate","name"],"sources":["../../../src/plugins/wss/wssPlugin.ts"],"sourcesContent":["import type { FastifyInstance } from 'fastify';\nimport fastifyPlugin from 'fastify-plugin';\nimport type { Server } from '../../types';\nimport { WebSocketDebuggerServer } from './servers/WebSocketDebuggerServer';\nimport { WebSocketDevClientServer } from './servers/WebSocketDevClientServer';\nimport { WebSocketMessageServer } from './servers/WebSocketMessageServer';\nimport { WebSocketEventsServer } from './servers/WebSocketEventsServer';\nimport { WebSocketApiServer } from './servers/WebSocketApiServer';\nimport { WebSocketHMRServer } from './servers/WebSocketHMRServer';\nimport { WebSocketRouter } from './WebSocketRouter';\nimport { WebSocketServerAdapter } from './WebSocketServerAdapter';\n\ndeclare module 'fastify' {\n  interface FastifyInstance {\n    wss: {\n      debuggerServer: WebSocketDebuggerServer;\n      devClientServer: WebSocketDevClientServer;\n      messageServer: WebSocketMessageServer;\n      eventsServer: WebSocketEventsServer;\n      apiServer: WebSocketApiServer;\n      hmrServer: WebSocketHMRServer;\n      deviceConnectionServer: WebSocketServerAdapter;\n      debuggerConnectionServer: WebSocketServerAdapter;\n      router: WebSocketRouter;\n    };\n  }\n}\n\n/**\n * Defined in @react-native/dev-middleware\n * Reference: https://github.com/facebook/react-native/blob/main/packages/dev-middleware/src/inspector-proxy/InspectorProxy.js\n */\nconst WS_DEVICE_URL = '/inspector/device';\nconst WS_DEBUGGER_URL = '/inspector/debug';\n\nasync function wssPlugin(\n  instance: FastifyInstance,\n  {\n    options,\n    delegate,\n  }: {\n    options: Server.Options;\n    delegate: Server.Delegate;\n  }\n) {\n  const router = new WebSocketRouter(instance);\n\n  const debuggerServer = new WebSocketDebuggerServer(instance);\n  const devClientServer = new WebSocketDevClientServer(instance);\n  const messageServer = new WebSocketMessageServer(instance);\n  const eventsServer = new WebSocketEventsServer(instance, {\n    webSocketMessageServer: messageServer,\n  });\n  const apiServer = new WebSocketApiServer(instance);\n  const hmrServer = new WebSocketHMRServer(instance, delegate.hmr);\n\n  // @react-native/dev-middleware servers\n  const deviceConnectionServer = new WebSocketServerAdapter(\n    instance,\n    WS_DEVICE_URL,\n    options.endpoints?.[WS_DEVICE_URL]\n  );\n\n  const debuggerConnectionServer = new WebSocketServerAdapter(\n    instance,\n    WS_DEBUGGER_URL,\n    options.endpoints?.[WS_DEBUGGER_URL]\n  );\n\n  router.registerServer(debuggerServer);\n  router.registerServer(devClientServer);\n  router.registerServer(messageServer);\n  router.registerServer(eventsServer);\n  router.registerServer(apiServer);\n  router.registerServer(hmrServer);\n  router.registerServer(deviceConnectionServer);\n  router.registerServer(debuggerConnectionServer);\n\n  instance.decorate('wss', {\n    debuggerServer,\n    devClientServer,\n    messageServer,\n    eventsServer,\n    apiServer,\n    hmrServer,\n    deviceConnectionServer,\n    debuggerConnectionServer,\n    router,\n  });\n}\n\nexport default fastifyPlugin(wssPlugin, {\n  name: 'wss-plugin',\n});\n"],"mappings":"AACA,OAAOA,aAAa,MAAM,gBAAgB;AAAC,SAElCC,uBAAuB;AAAA,SACvBC,wBAAwB;AAAA,SACxBC,sBAAsB;AAAA,SACtBC,qBAAqB;AAAA,SACrBC,kBAAkB;AAAA,SAClBC,kBAAkB;AAAA,SAClBC,eAAe;AAAA,SACfC,sBAAsB;AAkB/B;AACA;AACA;AACA;AACA,MAAMC,aAAa,GAAG,mBAAmB;AACzC,MAAMC,eAAe,GAAG,kBAAkB;AAE1C,eAAeC,SAASA,CACtBC,QAAyB,EACzB;EACEC,OAAO;EACPC;AAIF,CAAC,EACD;EACA,MAAMC,MAAM,GAAG,IAAIR,eAAe,CAACK,QAAQ,CAAC;EAE5C,MAAMI,cAAc,GAAG,IAAIf,uBAAuB,CAACW,QAAQ,CAAC;EAC5D,MAAMK,eAAe,GAAG,IAAIf,wBAAwB,CAACU,QAAQ,CAAC;EAC9D,MAAMM,aAAa,GAAG,IAAIf,sBAAsB,CAACS,QAAQ,CAAC;EAC1D,MAAMO,YAAY,GAAG,IAAIf,qBAAqB,CAACQ,QAAQ,EAAE;IACvDQ,sBAAsB,EAAEF;EAC1B,CAAC,CAAC;EACF,MAAMG,SAAS,GAAG,IAAIhB,kBAAkB,CAACO,QAAQ,CAAC;EAClD,MAAMU,SAAS,GAAG,IAAIhB,kBAAkB,CAACM,QAAQ,EAAEE,QAAQ,CAACS,GAAG,CAAC;;EAEhE;EACA,MAAMC,sBAAsB,GAAG,IAAIhB,sBAAsB,CACvDI,QAAQ,EACRH,aAAa,EACbI,OAAO,CAACY,SAAS,GAAGhB,aAAa,CACnC,CAAC;EAED,MAAMiB,wBAAwB,GAAG,IAAIlB,sBAAsB,CACzDI,QAAQ,EACRF,eAAe,EACfG,OAAO,CAACY,SAAS,GAAGf,eAAe,CACrC,CAAC;EAEDK,MAAM,CAACY,cAAc,CAACX,cAAc,CAAC;EACrCD,MAAM,CAACY,cAAc,CAACV,eAAe,CAAC;EACtCF,MAAM,CAACY,cAAc,CAACT,aAAa,CAAC;EACpCH,MAAM,CAACY,cAAc,CAACR,YAAY,CAAC;EACnCJ,MAAM,CAACY,cAAc,CAACN,SAAS,CAAC;EAChCN,MAAM,CAACY,cAAc,CAACL,SAAS,CAAC;EAChCP,MAAM,CAACY,cAAc,CAACH,sBAAsB,CAAC;EAC7CT,MAAM,CAACY,cAAc,CAACD,wBAAwB,CAAC;EAE/Cd,QAAQ,CAACgB,QAAQ,CAAC,KAAK,EAAE;IACvBZ,cAAc;IACdC,eAAe;IACfC,aAAa;IACbC,YAAY;IACZE,SAAS;IACTC,SAAS;IACTE,sBAAsB;IACtBE,wBAAwB;IACxBX;EACF,CAAC,CAAC;AACJ;AAEA,eAAef,aAAa,CAACW,SAAS,EAAE;EACtCkB,IAAI,EAAE;AACR,CAAC,CAAC","ignoreList":[]}