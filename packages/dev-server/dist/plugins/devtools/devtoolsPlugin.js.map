{"version":3,"file":"devtoolsPlugin.js","names":["open","fastifyPlugin","devtoolsPlugin","instance","options","route","method","url","handler","_request","reply","wss","messageServer","broadcast","send","request","customDebugger","process","env","REACT_DEBUGGER","debuggerServer","isDebuggerConnected","https","host","port","log","info","msg","error","name","dependencies"],"sources":["../../../src/plugins/devtools/devtoolsPlugin.ts"],"sourcesContent":["import open from 'open';\nimport type { FastifyInstance } from 'fastify';\nimport fastifyPlugin from 'fastify-plugin';\nimport type { Server } from '../../types';\n\nasync function devtoolsPlugin(\n  instance: FastifyInstance,\n  { options }: { options: Server.Options }\n) {\n  instance.route({\n    method: ['GET', 'POST', 'PUT'],\n    url: '/reload',\n    handler: (_request, reply) => {\n      instance.wss.messageServer.broadcast('reload');\n      reply.send('OK');\n    },\n  });\n\n  instance.route({\n    method: ['GET', 'POST', 'PUT'],\n    url: '/launch-js-devtools',\n    handler: async (request, reply) => {\n      const customDebugger = process.env.REACT_DEBUGGER;\n      if (customDebugger) {\n        // NOOP for now\n      } else if (!instance.wss.debuggerServer.isDebuggerConnected()) {\n        const url = `${options.https ? 'https' : 'http'}://${\n          options.host || 'localhost'\n        }:${options.port}/debugger-ui`;\n        try {\n          request.log.info({ msg: 'Opening debugger UI', url });\n          await open(url);\n        } catch (error) {\n          if (error) {\n            request.log.error({\n              msg: 'Cannot open debugger UI',\n              url,\n              error,\n            });\n          }\n        }\n      }\n      reply.send('OK');\n    },\n  });\n}\n\nexport default fastifyPlugin(devtoolsPlugin, {\n  name: 'devtools-plugin',\n  dependencies: ['wss-plugin'],\n});\n"],"mappings":"AAAA,OAAOA,IAAI,MAAM,MAAM;AAEvB,OAAOC,aAAa,MAAM,gBAAgB;AAG1C,eAAeC,cAAcA,CAC3BC,QAAyB,EACzB;EAAEC;AAAqC,CAAC,EACxC;EACAD,QAAQ,CAACE,KAAK,CAAC;IACbC,MAAM,EAAE,CAAC,KAAK,EAAE,MAAM,EAAE,KAAK,CAAC;IAC9BC,GAAG,EAAE,SAAS;IACdC,OAAO,EAAEA,CAACC,QAAQ,EAAEC,KAAK,KAAK;MAC5BP,QAAQ,CAACQ,GAAG,CAACC,aAAa,CAACC,SAAS,CAAC,QAAQ,CAAC;MAC9CH,KAAK,CAACI,IAAI,CAAC,IAAI,CAAC;IAClB;EACF,CAAC,CAAC;EAEFX,QAAQ,CAACE,KAAK,CAAC;IACbC,MAAM,EAAE,CAAC,KAAK,EAAE,MAAM,EAAE,KAAK,CAAC;IAC9BC,GAAG,EAAE,qBAAqB;IAC1BC,OAAO,EAAE,MAAAA,CAAOO,OAAO,EAAEL,KAAK,KAAK;MACjC,MAAMM,cAAc,GAAGC,OAAO,CAACC,GAAG,CAACC,cAAc;MACjD,IAAIH,cAAc,EAAE;QAClB;MAAA,CACD,MAAM,IAAI,CAACb,QAAQ,CAACQ,GAAG,CAACS,cAAc,CAACC,mBAAmB,CAAC,CAAC,EAAE;QAC7D,MAAMd,GAAG,GAAG,GAAGH,OAAO,CAACkB,KAAK,GAAG,OAAO,GAAG,MAAM,MAC7ClB,OAAO,CAACmB,IAAI,IAAI,WAAW,IACzBnB,OAAO,CAACoB,IAAI,cAAc;QAC9B,IAAI;UACFT,OAAO,CAACU,GAAG,CAACC,IAAI,CAAC;YAAEC,GAAG,EAAE,qBAAqB;YAAEpB;UAAI,CAAC,CAAC;UACrD,MAAMP,IAAI,CAACO,GAAG,CAAC;QACjB,CAAC,CAAC,OAAOqB,KAAK,EAAE;UACd,IAAIA,KAAK,EAAE;YACTb,OAAO,CAACU,GAAG,CAACG,KAAK,CAAC;cAChBD,GAAG,EAAE,yBAAyB;cAC9BpB,GAAG;cACHqB;YACF,CAAC,CAAC;UACJ;QACF;MACF;MACAlB,KAAK,CAACI,IAAI,CAAC,IAAI,CAAC;IAClB;EACF,CAAC,CAAC;AACJ;AAEA,eAAeb,aAAa,CAACC,cAAc,EAAE;EAC3C2B,IAAI,EAAE,iBAAiB;EACvBC,YAAY,EAAE,CAAC,YAAY;AAC7B,CAAC,CAAC","ignoreList":[]}