{"version":3,"file":"FileReporter.js","names":["_fs","_interopRequireDefault","require","_path","_lodash","e","__esModule","default","FileReporter","buffer","constructor","config","path","isAbsolute","filename","join","process","cwd","fs","mkdirSync","dirname","recursive","throttledFlush","throttle","flush","log","push","JSON","stringify","length","writeFileSync","flag","stop","exports"],"sources":["../../../src/logging/reporters/FileReporter.ts"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport throttle from 'lodash.throttle';\nimport type { LogEntry, Reporter } from '../types';\n\nexport interface FileReporterConfig {\n  filename: string;\n}\n\nexport class FileReporter implements Reporter {\n  private buffer: string[] = ['\\n\\n--- BEGINNING OF NEW LOG ---\\n'];\n\n  constructor(private config: FileReporterConfig) {\n    if (!path.isAbsolute(this.config.filename)) {\n      this.config.filename = path.join(process.cwd(), this.config.filename);\n    }\n\n    fs.mkdirSync(path.dirname(this.config.filename), { recursive: true });\n  }\n\n  throttledFlush: () => void = throttle(() => {\n    this.flush();\n  }, 1000);\n\n  process(log: LogEntry) {\n    this.buffer.push(JSON.stringify(log));\n    this.throttledFlush();\n  }\n\n  flush() {\n    if (!this.buffer.length) {\n      return;\n    }\n\n    fs.writeFileSync(this.config.filename, this.buffer.join('\\n'), {\n      flag: 'a',\n    });\n    this.buffer = [];\n  }\n\n  stop() {\n    this.flush();\n  }\n}\n"],"mappings":";;;;;;AAAA,IAAAA,GAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,KAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,OAAA,GAAAH,sBAAA,CAAAC,OAAA;AAAuC,SAAAD,uBAAAI,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAOhC,MAAMG,YAAY,CAAqB;EACpCC,MAAM,GAAa,CAAC,oCAAoC,CAAC;EAEjEC,WAAWA,CAASC,MAA0B,EAAE;IAAA,KAA5BA,MAA0B,GAA1BA,MAA0B;IAC5C,IAAI,CAACC,aAAI,CAACC,UAAU,CAAC,IAAI,CAACF,MAAM,CAACG,QAAQ,CAAC,EAAE;MAC1C,IAAI,CAACH,MAAM,CAACG,QAAQ,GAAGF,aAAI,CAACG,IAAI,CAACC,OAAO,CAACC,GAAG,CAAC,CAAC,EAAE,IAAI,CAACN,MAAM,CAACG,QAAQ,CAAC;IACvE;IAEAI,WAAE,CAACC,SAAS,CAACP,aAAI,CAACQ,OAAO,CAAC,IAAI,CAACT,MAAM,CAACG,QAAQ,CAAC,EAAE;MAAEO,SAAS,EAAE;IAAK,CAAC,CAAC;EACvE;EAEAC,cAAc,GAAe,IAAAC,eAAQ,EAAC,MAAM;IAC1C,IAAI,CAACC,KAAK,CAAC,CAAC;EACd,CAAC,EAAE,IAAI,CAAC;EAERR,OAAOA,CAACS,GAAa,EAAE;IACrB,IAAI,CAAChB,MAAM,CAACiB,IAAI,CAACC,IAAI,CAACC,SAAS,CAACH,GAAG,CAAC,CAAC;IACrC,IAAI,CAACH,cAAc,CAAC,CAAC;EACvB;EAEAE,KAAKA,CAAA,EAAG;IACN,IAAI,CAAC,IAAI,CAACf,MAAM,CAACoB,MAAM,EAAE;MACvB;IACF;IAEAX,WAAE,CAACY,aAAa,CAAC,IAAI,CAACnB,MAAM,CAACG,QAAQ,EAAE,IAAI,CAACL,MAAM,CAACM,IAAI,CAAC,IAAI,CAAC,EAAE;MAC7DgB,IAAI,EAAE;IACR,CAAC,CAAC;IACF,IAAI,CAACtB,MAAM,GAAG,EAAE;EAClB;EAEAuB,IAAIA,CAAA,EAAG;IACL,IAAI,CAACR,KAAK,CAAC,CAAC;EACd;AACF;AAACS,OAAA,CAAAzB,YAAA,GAAAA,YAAA","ignoreList":[]}